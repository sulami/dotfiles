# -*- mode: sh -*-

# yabai -m config layout float
yabai -m config layout bsp

# Mouse actions (fn +)
yabai -m config mouse_action1 resize
yabai -m config mouse_action2 move

# Shadows only for floating windows.
yabai -m config window_shadow float

# Rules
yabai -m rule --add title="^Open$" manage=off
yabai -m rule --add app="^Activity Monitor$" manage=off
yabai -m rule --add app="^System Preferences$" manage=off
yabai -m rule --add label=zoom app="^(Z|z)oom(.us)$" space=3
yabai -m rule --add label=ff-pip app="^Firefox Developer Edition$" title="^Picture-in-Picture$" manage=off sticky=on
yabai -m rule --add app="^Firefox Developer Edition$" title="^Opening .+$" manage=off
yabai -m rule --add app="^Firefox Developer Edition$" title="^Launch Application$" manage=off
yabai -m rule --add app="^Calendar$" manage=off

# Hack in automatic v-stack layout. Requires jq.
# +------+    +---+--+     +---+--+
# |      |    |   |  |     |   |  |
# |      | => |   |  |  => |   +--+
# |      |    |   |  |     |   |  |
# +------+    +---+--+     +---+--+

yabai -m config auto_balance off
yabai -m config split_ratio 0.6
yabai -m signal --add \
      label=new-window-tile \
      event=window_created \
      action='yabai -m window $YABAI_WINDOW_ID --warp last; \
              if [[ `yabai -m query --windows --space | jq -r "length"` = 2 ]] && [[ `yabai -m query --windows --window $YABAI_WINDOW_ID | jq -r ".split"` = "horizontal" ]]; then \
                yabai -m window --toggle split; \
              elif [[ `yabai -m query --windows --space | jq -r "length"` != 2 ]] && [[ `yabai -m query --windows --window $YABAI_WINDOW_ID | jq -r ".split"` = "vertical" ]]; then \
                yabai -m window --toggle split; \
              fi;'
